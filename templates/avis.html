{% extends "base.html" %}

{% block title %}Guest Reviews{% endblock %}

{% block content %}
<h1>Guest Reviews</h1>

{% if session.role == 'admin' %}
<div class="card mb-4">
    <div class="card-header">Reviews Pending Moderation</div>
    <div class="card-body">
        {% if pending_avis %}
        <ul class="list-group">
            {% for review in pending_avis %}
            <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="ms-2 me-auto">
                    <div class="fw-bold">{{ review.client_name }} (Reservation #{{ review.id_reservation }}) - {{ review.date_avis }}</div>
                    <span class="badge bg-warning text-dark">Rating: {{ review.note }}/5</span>
                    <p class="mb-0 mt-1">{{ review.commentaire }}</p>
                </div>
                 <form action="{{ url_for('approve_avis', id=review.id_avis) }}" method="post" style="display: inline;" class="ms-2">
                     <button type="submit" class="btn btn-success btn-sm">Approve</button>
                 </form>
                 <form action="{{ url_for('delete_avis', id=review.id_avis) }}" method="post" style="display: inline;" class="ms-2" onsubmit="return confirm('Are you sure you want to delete this review?');">
                     <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                 </form>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">No reviews are currently pending moderation.</p>
        {% endif %}
    </div>
</div>
{% endif %} {# End Admin check #}


<h2>Approved Reviews</h2>
{% if approved_avis %}
<div class="list-group">
    {% for review in approved_avis %}
    <div class="list-group-item list-group-item-action flex-column align-items-start mb-2">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ review.client_name }}</h5>
            <small>{{ review.date_avis }}</small>
        </div>
         <p class="mb-1"><strong>Rating: {{ review.note }}/5</strong></p>
        <p class="mb-1">{{ review.commentaire }}</p>
         {% if session.role == 'admin' %} {# Admin might still want to delete approved reviews #}
            <form action="{{ url_for('delete_avis', id=review.id_avis) }}" method="post" style="display: inline;" class="mt-1" onsubmit="return confirm('Are you sure you want to delete this approved review?');">
                 <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
            </form>
         {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<p class="text-muted">No approved reviews yet.</p>
{% endif %}

<!-- Note: A form for clients to *submit* reviews would likely be on a different page or workflow -->

{% endblock %}